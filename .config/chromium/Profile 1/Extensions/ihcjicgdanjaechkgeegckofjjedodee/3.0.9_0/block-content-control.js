chrome||browser||(window.chrome=chrome||window.chrome||window.browser),(chrome||window.chrome).runtime.getURL(""),(()=>{"use strict";const e="undefined"!=typeof window?window:self,t=e.chrome||e.browser||browser;let n;console.log(`POLYFILL => User Agent: ${navigator.userAgent}, Browser: ${t}`);try{n=indexedDB||e.indexedDB}catch(e){console.log(`Error initializing indexedDB: ${e.message}`)}performance||e.performance,URL||e.URL,t.i18n.getUILanguage().split("-")[0];const r=(e,n=document)=>e.forEach((({id:e,msg:r,sub:o=null})=>{const i=n.getElementById(e);i&&(i.textContent=t.i18n.getMessage(r,o||void 0))}));Object.defineProperty({},"browser",{writable:!0}),Object.defineProperty({},"os",{writable:!0}),Object.defineProperty({},"isMV3",{writable:!0});let o={};Object.defineProperty(o,"bgVersion",{writable:!0}),o.bgVersion||t.runtime.getManifest(),Object.freeze({LicenseStateUnknown:0,LicenseStateFree:1,LicenseStateTrial:2,LicenseStateTrialExpired:3,LicenseStateLicensed:4,LicenseStateLicenseExpired:5,LicenseStateLicenseGrace:6}),Object.freeze([2,4,6]);const i="enableNativeMessaging",s={};function a(){if(s.params.prevUrl&&s.params.prevUrl.length>0)return window.location.replace(s.params.prevUrl);if(window.history.length>1)return window.history.go(-1);let e;try{e=new URL(s.params.referrer)}catch(e){}t.tabs.query({currentWindow:!0,active:!0},(n=>{e?t.tabs.query({currentWindow:!0,url:`${e.origin}/*`},(e=>{e[0].index&&t.tabs.highlight({tabs:e[0].index},(()=>{n[0].id&&t.tabs.remove(n[0].id)}))})):n[0].id&&t.tabs.remove(n[0].id)}))}s.templateParameters=()=>function(e){let t={},n=new URLSearchParams(e).entries();for(let e of n){const n="$"+e[0];"null"===e[1]?t[n]=null:"undefined"===e[1]?t[n]=void 0:t[n]=e[1]}return new Proxy(t,{get:(e,t)=>t.startsWith("$")?e[t]:e[`$${t}`]})}(window.location.search),s.params=s.templateParameters(),document.addEventListener("DOMContentLoaded",(function(){window.addEventListener("resize",(()=>{$("#mbbgb-inf").popup({inline:!0,hoverable:!0,lastResort:"bottom center"})})),r([{id:"blocked-by-title",msg:"blockedByTitle"},{id:"block-reason",msg:"contentControlWebsiteBlockHeader"},{id:"block-explanation",msg:"contentControlWebsiteBlockExplanation"},{id:"block-alert-text",msg:"contentControlBlockAlertText"},{id:"block-alert-link",msg:"mv3WebsiteBlockMalwarebytesSupport"},{id:"block-go-back",msg:"mv3WebsiteBlockGoBack"},{id:"block-learn-more",msg:"mv3WebsiteBlockLearnMore"},{id:"block-learn-more-link",msg:"mv3WebsiteBlockLearnMoreLink"}]),function(){const e=document.querySelector("#block-url"),t=((e,t=2048)=>e.length>t?e.substr(0,t-1)+"...":e)(s.params.url);e.textContent=t}(),document.getElementById("go-back").addEventListener("click",a),t.runtime.sendMessage({type:"MSG_IS_NEEDING_NATIVE_MSG",parameters:{source:"contentControlBlockPage"}},(e=>{t.runtime.lastError&&console.error("MBN: Chrome Runtime Failure: ",t.runtime.lastError),e&&e.needsIt&&($("#mbbgb-header-footer").animate({"max-height":"100%",opacity:1},800),c())}))}));const c=()=>{r([{id:"nm-header",msg:"nativeMessagingHeader2"},{id:"nm-message",msg:"nativeMessagingMessage2"},{id:"decline-nm",msg:"buttonOptOut"},{id:"accept-nm",msg:"buttonOptIn"}]),[{id:"accept-nm",val:!0},{id:"decline-nm",val:!1}].forEach((({id:e,val:n})=>{document.getElementById(e).addEventListener("click",(async()=>{let e=n?await new Promise((e=>{t.permissions.request({permissions:["nativeMessaging"]},(t=>{console.log("MMPPNM: Permissions request resp: ",t),e(t)}))})):await new Promise((e=>{t.permissions.remove({permissions:["nativeMessaging"]},(t=>{t?(console.debug("MRNM: Successfully removed permissions"),e(!1)):(console.log("MRNM: Did not remove permissions... ",t),e(!0))}))}));t.runtime.sendMessage({type:"MSG_SETTINGS_SET",payload:{[i]:e}},(t=>{!t||t.error?console.error(t&&t.error):console.debug(`PR: Turned ${e?"on":"off"} Native Messaging`),document.getElementById("mbbgb-header-footer").style.display="none"}))}))}))}})();