chrome||browser||(window.chrome=chrome||window.chrome||window.browser),(chrome||window.chrome).runtime.getURL(""),(()=>{"use strict";const e=(Object.freeze({LicenseStateUnknown:0,LicenseStateFree:1,LicenseStateTrial:2,LicenseStateTrialExpired:3,LicenseStateLicensed:4,LicenseStateLicenseExpired:5,LicenseStateLicenseGrace:6}),Object.freeze([2,4,6]),"enableNativeMessaging"),a="undefined"!=typeof window?window:self,s=a.chrome||a.browser||browser;let r;console.log(`POLYFILL => User Agent: ${navigator.userAgent}, Browser: ${s}`);try{r=indexedDB||a.indexedDB}catch(e){console.log(`Error initializing indexedDB: ${e.message}`)}performance||a.performance,URL||a.URL,s.i18n.getUILanguage().split("-")[0];const t=(e,a=document)=>e.forEach((({id:e,msg:r,sub:t=null})=>{const n=a.getElementById(e);n&&(n.textContent=s.i18n.getMessage(r,t||void 0))}));Object.defineProperty({},"browser",{writable:!0}),Object.defineProperty({},"os",{writable:!0}),Object.defineProperty({},"isMV3",{writable:!0});let n={};Object.defineProperty(n,"bgVersion",{writable:!0}),n.bgVersion||s.runtime.getManifest(),console.debug("BLOCK PAGE");let o={};const i=e=>{const a=(e=>{if(!e)return console.debug("UE: Params Error: No URL passed"),null;e.includes("//")&&(e=e.substring(e.indexOf("//")+2));const a=e.lastIndexOf("/");if(-1!==a&&-1!==e.indexOf(".",a+1)){let s=a+1,r="";for(;s<e.length&&"?"!==e[s];)r+=e[s],s++;let t=r.split(".");if(t=t.filter((e=>""!==e)),t.length>1)return t[t.length-1].toLowerCase()}return null})(e),s=a&&o.params.referrer?`http://${o.params.referrer.split(/^https?:\/\//)[1]}`:`http://${o.params.url.split(/^https?:\/\//)[1]}`;console.debug("Add exclusions was successful. Will redirect to: ",s),window.location.href=s};function l(){const e=document.getElementById("continue-always").checked;console.debug("BLOCK_MV2: Continue ",{continueAlways:e,url:o.params.url});let a=o.getExclusionConst(o.params.type);e?o.updateAllowListViaMessage(o.params,a):o.excludeTemporary(a)}function c(){if(o.params.prevUrl&&o.params.prevUrl.length>0)return window.location.replace(o.params.prevUrl);if(window.history.length>1)return window.history.go(-1);let e;try{e=new URL(o.params.referrer)}catch(e){}s.tabs.query({currentWindow:!0,active:!0},(a=>{e?s.tabs.query({currentWindow:!0,url:`${e.origin}/*`},(e=>{e[0].index&&s.tabs.highlight({tabs:e[0].index},(()=>{a[0].id&&s.tabs.remove(a[0].id)}))})):a[0].id&&s.tabs.remove(a[0].id)}))}o.typesAsPlural=e=>{switch(e){case"malware":case"ads":default:return e;case"scam":case"ad":return`${e}s`}},o.templateParameters=()=>function(e){let a={},s=new URLSearchParams(e).entries();for(let e of s){const s="$"+e[0];"null"===e[1]?a[s]=null:"undefined"===e[1]?a[s]=void 0:a[s]=e[1]}return new Proxy(a,{get:(e,a)=>a.startsWith("$")?e[a]:e[`$${a}`]})}(window.location.search),o.params=o.templateParameters(),console.debug("BLOCK PAGE PARAMS: ",o.params),o.getExclusionConst=e=>{switch(e){case"malware":return"EXCLUSION_MALWARE";case"scam":return"EXCLUSION_SCAMS";case"ad":case"ads":return"EXCLUSION_ADS";default:console.error("The block page exclusion checkbox has not handled '"+o.params.type+"'")}},o.updateAllowListViaMessage=(e,a)=>{if(a){let r=["full-url-malware","malware-pattern"].includes(e.subtype)||"specific"===e.rules?e.url:e.host;$("#continue-always").is(":checked")?(console.debug("Checkbox switched on - requesting allow for "+a),s.runtime.sendMessage({type:"MSG_ADD_ALLOW",payload:{host:r,allow:a}},(function(a){!a||a.error?console.error(a?a.error:"NO RESPONSE!"):i(e.url)}))):(console.debug("Checkbox switched off - requesting block for "+a),s.runtime.sendMessage({type:"MSG_REM_ALLOW_SINGLE",payload:{host:r,exclusion:a}},(function(e){!e||e.error?console.error(e?e.error:"NO RESPONSE!"):console.debug("Remove exclusions was successful")})))}},o.excludeTemporary=e=>{if(!$("#mb-do-not-block").checked)return new Promise((e=>{null!==o.params.tabId?e(o.params.tabId):s.tabs.query({currentWindow:!0,active:!0},(function(a){e(a[0].id)}))})).then((a=>{s.runtime.sendMessage({type:"MSG_ADD_ALLOW_TEMPORARY",host:o.params.url||o.params.host,initiator:a,exclusion:e},(function(e){return!e||e.error?Promise.reject(e?e.error:null):Promise.resolve(e.success)}))})).then((()=>{i(o.params.url)})).catch((e=>{console.error(e)})),!1},o.getExplanationText=()=>{switch(o.params.subtype){case"adware":return s.i18n.getMessage("blockExplainAdware");case"compromised":return s.i18n.getMessage("blockExplainCompromised");case"exploit":return s.i18n.getMessage("blockExplainExploit");case"fraud":return s.i18n.getMessage("blockExplainFradulent");case"hijack":return s.i18n.getMessage("blockExplainHijack");case"malvertising":return s.i18n.getMessage("blockExplainMalvertising");case"malware":return s.i18n.getMessage("blockExplainMalware");case"pharma":return s.i18n.getMessage("blockExplainPharma");case"phishing":return s.i18n.getMessage("blockExplainPhishing");case"ransomware":return s.i18n.getMessage("blockExplainRansomware");case"reputation":return s.i18n.getMessage("blockExplainReputation");case"riskware":return s.i18n.getMessage("blockExplainRiskware");case"scam":return s.i18n.getMessage("blockExplainScam");case"spam":return s.i18n.getMessage("blockExplainSpam");case"spyware":return s.i18n.getMessage("blockExplainSpyware");case"trojan":return s.i18n.getMessage("blockExplainTrojan");case"worm":return s.i18n.getMessage("blockExplainWorm");default:return s.i18n.getMessage("blockExplainDefault")}},o.getExplanationLink=()=>{switch(o.params.subtype){case"adware":return"https://www.malwarebytes.com/adware/?guard=1&x-source=threatlearn";case"compromised":return"https://blog.malwarebytes.com/glossary/compromised/?guard=1&x-source=threatlearn";case"exploit":return"https://blog.malwarebytes.com/glossary/exploit/?guard=1&x-source=threatlearn";case"fraud":return"https://blog.malwarebytes.com/glossary/fraud/?guard=1&x-source=threatlearn";case"hijack":return"https://blog.malwarebytes.com/glossary/hijack/?guard=1&x-source=threatlearn";case"malvertising":return"https://blog.malwarebytes.com/glossary/malvertising/?guard=1&x-source=threatlearn";case"pharma":return"https://blog.malwarebytes.com/glossary/pharma/?guard=1&x-source=threatlearn";case"phishing":return"https://blog.malwarebytes.com/glossary/phishing/?guard=1&x-source=threatlearn";case"ransomware":return"https://www.malwarebytes.com/ransomware/?guard=1&x-source=threatlearn";case"reputation":case"malware":default:return"https://blog.malwarebytes.com/glossary/malware/?guard=1&x-source=threatlearn";case"riskware":return"https://blog.malwarebytes.com/glossary/riskware/?guard=1&x-source=threatlearn";case"scam":return"https://blog.malwarebytes.com/glossary/scam/?guard=1&x-source=threatlearn";case"spam":return"https://blog.malwarebytes.com/glossary/spam/?guard=1&x-source=threatlearn";case"spyware":return"https://www.malwarebytes.com/spyware/?guard=1&x-source=threatlearn";case"suspiciousPage":case"riskyPattern":case"suspiciousContent":case"suspicious":return"https://blog.malwarebytes.com/glossary/suspicious-activity/?guard=1&x-source=threatlearn";case"suspiciousTLD":return"https://blog.malwarebytes.com/glossary/TLD/?guard=1&x-source=threatlearn";case"trojan":return"https://blog.malwarebytes.com/glossary/trojan/?guard=1&x-source=threatlearn";case"worm":return"https://blog.malwarebytes.com/glossary/worm/?guard=1&x-source=threatlearn"}},o.humanReadableSubType=()=>o.params.subtype?"full-url-malware"===o.params.subtype?"malware":"suspiciousPage"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeSuspiciousPage"):"suspiciousTLD"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeSuspiciousTLD"):"riskyPattern"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeRiskyPattern"):"suspiciousContent"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeSuspiciousContent"):"malware-pattern"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeMalwarePattern"):"alertLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeAlertLoop"):"authRequiredLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeAuthRequiredLoop"):"createURLLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeCreateURLLoop"):"extensionInstall"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeExtensionInstall"):"fullScreenLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeFullScreenLoop"):"historyLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeHistoryLoop"):"notificationLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypeNotificationLoop"):"printLoop"===o.params.subtype?s.i18n.getMessage("humanReadableSubTypePrintLoop"):o.params.subtype:o.params.type,document.addEventListener("DOMContentLoaded",(function(){new Promise(((e,a)=>{s.runtime.sendMessage({type:"MSG_IS_PREMIUM"},(function(s){!s||s.error?(console.error("Failed to check if premium: "+s.error),a(s.error)):(console.debug("Is premium: "+s.success),e(s.success))}))})).then((e=>{e||(document.getElementById("upgrade-protection").style.display="inherit")})),window.addEventListener("resize",(()=>{$("#mbbgb-inf").popup({inline:!0,hoverable:!0,lastResort:"bottom center"})})),function(){$("#mbbgb-inf").popup({inline:!0,hoverable:!0,lastResort:"bottom center"}),t([{id:"blocked-by-title",msg:"blockedByTitle"},{id:"block-explanation",msg:"mv3WebsiteBlockExplanation"},{id:"block-alert-text",msg:"mv3WebsiteBlockAlert"},{id:"block-alert-link",msg:"mv3WebsiteBlockMalwarebytesSupport"},{id:"block-go-back",msg:"mv3WebsiteBlockGoBack"},{id:"continue-button",msg:"mv3WebsiteBlockContinue"},{id:"block-continue-always",msg:"mv3WebsiteBlockContinueAlways"},{id:"block-level-up",msg:"mv3WebsiteBlockLevelUp"},{id:"block-level-up-info",msg:"mv3WebsiteBlockLevelUpInfo"},{id:"block-level-up-info-link",msg:"mv3WebsiteBlockLevelUpInfoLink"},{id:"block-level-up-info-contd",msg:"mv3WebsiteBlockLevelUpInfoContd"},{id:"block-get-started",msg:"mv3WebsiteBlockGetStarted"},{id:"block-learn-more",msg:"mv3WebsiteBlockLearnMore"},{id:"block-learn-more-link",msg:"mv3WebsiteBlockLearnMoreLink"}]);const e=o.params.subtype&&""!==o.params.subtype?o.humanReadableSubType():o.typesAsPlural(o.params.type);$("#block-reason").text(s.i18n.getMessage("websiteBlockHeader")+" "+e)}(),async function(){const e=document.getElementById("app-db-version"),a=s.runtime.getManifest().version,r=await(t="lastDBused",new Promise(((e,a)=>{s.storage.local.get(t,(r=>s.runtime.lastError?a(s.runtime.lastError):e(r[t])))})));var t;const n=`Heuristics: ${o.humanReadableSubType()}`;e.textContent=`v${a} | ${null==r?n:r}`}(),function(){const e=document.querySelector("#block-url"),a=((e,a=2048)=>e.length>a?e.substr(0,a-1)+"...":e)(o.params.host);e.textContent=a}(),document.getElementById("go-back").addEventListener("click",c),document.getElementById("continue-button").addEventListener("click",l),s.runtime.sendMessage({type:"MSG_IS_NEEDING_NATIVE_MSG",parameters:{source:"blockPage"}},(a=>{s.runtime.lastError&&console.error("MBN: Chrome Runtime Failure: ",s.runtime.lastError),a&&a.needsIt&&($("#mbbgb-header-footer").animate({"max-height":"100%",opacity:1},800),t([{id:"nm-header",msg:"nativeMessagingHeader2"},{id:"nm-message",msg:"nativeMessagingMessage2"},{id:"decline-nm",msg:"buttonOptOut"},{id:"accept-nm",msg:"buttonOptIn"}]),[{id:"accept-nm",val:!0},{id:"decline-nm",val:!1}].forEach((({id:a,val:r})=>{document.getElementById(a).addEventListener("click",(async()=>{let a=r?await new Promise((e=>{s.permissions.request({permissions:["nativeMessaging"]},(a=>{console.log("MMPPNM: Permissions request resp: ",a),e(a)}))})):await new Promise((e=>{s.permissions.remove({permissions:["nativeMessaging"]},(a=>{a?(console.debug("MRNM: Successfully removed permissions"),e(!1)):(console.log("MRNM: Did not remove permissions... ",a),e(!0))}))}));s.runtime.sendMessage({type:"MSG_SETTINGS_SET",payload:{[e]:a}},(e=>{!e||e.error?console.error(e&&e.error):console.debug(`PR: Turned ${a?"on":"off"} Native Messaging`),document.getElementById("mbbgb-header-footer").style.display="none"}))}))})))}))}))})();