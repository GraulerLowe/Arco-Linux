chrome||browser||(window.chrome=chrome||window.chrome||window.browser),(chrome||window.chrome).runtime.getURL(""),(()=>{"use strict";const e="undefined"!=typeof window?window:self,t=e.chrome||e.browser||browser;let o;console.log(`POLYFILL => User Agent: ${navigator.userAgent}, Browser: ${t}`);try{o=indexedDB||e.indexedDB}catch(e){console.log(`Error initializing indexedDB: ${e.message}`)}performance||e.performance,URL||e.URL,t.i18n.getUILanguage().split("-")[0];const n=function(e){if(null==e||""===e)return"";if(r(e))return"";e.toLowerCase().startsWith("blob:")&&(e=e.substring(5));try{return e.toLowerCase().startsWith("http://")||e.toLowerCase().startsWith("https://")||(e=`http://${e}`),new URL(e).hostname}catch(t){return console.debug("UH: invalid URL ",e," ",t),e}};Object.defineProperty({},"browser",{writable:!0}),Object.defineProperty({},"os",{writable:!0}),Object.defineProperty({},"isMV3",{writable:!0});let s={};Object.defineProperty(s,"bgVersion",{writable:!0}),s.bgVersion||t.runtime.getManifest();const r=e=>e.startsWith("chrome-extension://")||e.startsWith("moz-extension://")||e.startsWith("edge-extension://")||e.startsWith("edge://")||e.startsWith("file://")||e.startsWith("about:")||e.startsWith("chrome-devtools://")||e.startsWith("devtools://")||e.startsWith("chrome://");Object.freeze({LicenseStateUnknown:0,LicenseStateFree:1,LicenseStateTrial:2,LicenseStateTrialExpired:3,LicenseStateLicensed:4,LicenseStateLicenseExpired:5,LicenseStateLicenseGrace:6}),Object.freeze([2,4,6]);let i={templateParameters:()=>function(e){let t={},o=new URLSearchParams(e).entries();for(let e of o){const o="$"+e[0];"null"===e[1]?t[o]=null:"undefined"===e[1]?t[o]=void 0:t[o]=e[1]}return new Proxy(t,{get:(e,t)=>t.startsWith("$")?e[t]:e[`$${t}`]})}(window.location.search)},a=i.templateParameters();window.params=a,console.debug("BLOCK_MV3: MV3 BLOCK PAGE PARAMS: ",{params:a}),i.updateAllowListViaMessage=e=>{const o=document.getElementById("continue-always").checked,s=e.url?n(e.url):n(e.referrer),r=["EXCLUSION_ADS","EXCLUSION_MALWARE","EXCLUSION_SCAMS","EXCLUSION_PUPS"];o?(console.debug("BLOCK_MV3: Checkbox switched on - requesting allow for "+r),t.runtime.sendMessage({type:"MSG_ADD_ALLOW",payload:{host:s,allow:r}},(function(t){!t||t.error?console.error(t?t.error:"NO RESPONSE!"):l(e.url)}))):(console.debug("BLOCK_MV3: Checkbox switched off - requesting block for "+r),t.runtime.sendMessage({type:"MSG_REM_ALLOW_SINGLE",payload:{host:s,exclusion:r}},(function(e){!e||e.error?console.error(e?e.error:"NO RESPONSE!"):console.debug("BLOCK_MV3: Remove exclusions was successful")})))},i.excludeTemporary=async e=>{if(document.getElementById("continue-always").checked);else try{let o=a.tabId;o||(o=(await t.tabs.getCurrent()).id);const s=a.url?n(a.url):n(a.referrer),r=await t.runtime.sendMessage({type:"MSG_ADD_ALLOW_TEMPORARY",host:s,initiator:o,exclusion:e,filename:a.filename});r&&r.success&&(console.debug(`blockPage.excludeTemporary: Redirecting to ${a.url}`),l(a.url))}catch(e){console.error(e)}};const l=e=>{if(console.debug("BLOCK_MV3: Add exclusions was successful. Will redirect to: ",e),a.filename)return void c();const t=e.split(/^https?:\/\//),o=`http://${t.length>1?t[1]:t[0]}`;console.debug("BLOCK_MV3: Redirecting to: ",o),window.location.href=o};function c(){if(a.prevUrl&&a.prevUrl.length>0)return window.location.replace(a.prevUrl);if(window.history.length>1)return window.history.go(-1);let e;try{e=new URL(a.referrer)}catch(e){}t.tabs.query({currentWindow:!0,active:!0},(o=>{e?t.tabs.query({currentWindow:!0,url:`${e.origin}/*`},(e=>{e[0].index&&t.tabs.highlight({tabs:e[0].index},(()=>{o[0].id&&t.tabs.remove(o[0].id)}))})):o[0].id&&t.tabs.remove(o[0].id)}))}function u(){const e=document.getElementById("continue-always").checked;console.debug("BLOCK_MV3: Continue ",{continueAlways:e,url:a.url}),e?i.updateAllowListViaMessage(a):i.excludeTemporary()}function d(){return a.subtype?"full-url-malware"===a.subtype?"malware":"suspiciousPage"===a.subtype?t.i18n.getMessage("humanReadableSubTypeSuspiciousPage"):"suspiciousTLD"===a.subtype?t.i18n.getMessage("humanReadableSubTypeSuspiciousTLD"):"riskyPattern"===a.subtype?t.i18n.getMessage("humanReadableSubTypeRiskyPattern"):"suspiciousContent"===a.subtype?t.i18n.getMessage("humanReadableSubTypeSuspiciousContent"):"malware-pattern"===a.subtype?t.i18n.getMessage("humanReadableSubTypeMalwarePattern"):"alertLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeAlertLoop"):"authRequiredLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeAuthRequiredLoop"):"createURLLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeCreateURLLoop"):"extensionInstall"===a.subtype?t.i18n.getMessage("humanReadableSubTypeExtensionInstall"):"fullScreenLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeFullScreenLoop"):"historyLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeHistoryLoop"):"notificationLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypeNotificationLoop"):"printLoop"===a.subtype?t.i18n.getMessage("humanReadableSubTypePrintLoop"):a.subtype:a.type}document.addEventListener("DOMContentLoaded",(()=>{(function(){((e,o=document)=>{[{id:"blocked-by-title",msg:"blockedByTitle"},{id:"mv3-block-header",msg:"mv3WebsiteBlockHeader"},{id:"mv3-block-explanation",msg:"mv3WebsiteBlockExplanation"},{id:"mv3-block-alert-text",msg:"mv3WebsiteBlockAlert"},{id:"mv3-block-alert-link",msg:"mv3WebsiteBlockMalwarebytesSupport"},{id:"mv3-block-go-back",msg:"mv3WebsiteBlockGoBack"},{id:"continue-button",msg:"mv3WebsiteBlockContinue"},{id:"mv3-block-continue-always",msg:"mv3WebsiteBlockContinueAlways"},{id:"mv3-block-level-up",msg:"mv3WebsiteBlockLevelUp"},{id:"mv3-block-level-up-info",msg:"mv3WebsiteBlockLevelUpInfo"},{id:"mv3-block-level-up-info-link",msg:"mv3WebsiteBlockLevelUpInfoLink"},{id:"mv3-block-level-up-info-contd",msg:"mv3WebsiteBlockLevelUpInfoContd"},{id:"mv3-block-get-started",msg:"mv3WebsiteBlockGetStarted"},{id:"mv3-block-learn-more",msg:"mv3WebsiteBlockLearnMore"},{id:"mv3-block-learn-more-link",msg:"mv3WebsiteBlockLearnMoreLink"}].forEach((({id:e,msg:n,sub:s=null})=>{const r=o.getElementById(e);r&&(r.textContent=t.i18n.getMessage(n,s||void 0))}))})();const e=window.params.subtype&&""!==window.params.subtype?d():function(e){switch(e){case"malware":case"ads":default:return e;case"scam":case"ad":return`${e}s`}}(a.type);$("#block-reason").text(t.i18n.getMessage("websiteBlockHeader")+" "+e)})(),document.getElementById("go-back").addEventListener("click",c),document.getElementById("continue-button").addEventListener("click",u),async function(){const e=await t.tabs.getCurrent();if(!e)return null;const o=e.id;try{const e=await t.runtime.sendMessage({type:"MSG_MV3_LAST_TAB_URL",payload:{tabId:o},mv3:!0});return e&&e.url?{tabId:o,url:e.url}:{tabId:o,url:null}}catch(e){throw console.error("Failed to get last tab url",e),e}}().then((({tabId:e,url:o})=>{console.debug("BLOCK_MV3: Curr url: ",{tabId:e,url:o}),a.url=o,a.tabId=e,async function(e,o){try{await t.runtime.sendMessage({type:"MSG_MV3_POST_NATIVE_EXCLUSION",mv3:!0,tabId:e,url:o}),console.debug("BLOCK_MV3: Posted mv3 native exclusion")}catch(e){console.error("BLOCK_MV3: Failed to post mv3 native exclusion",e)}}(e,o),function(){const e=document.querySelector("#mv3-block-url");let t=a.url;console.debug("BLOCK_MV3: URL: ",{url:t}),t.endsWith("/")&&(t=t.substring(0,t.length-1)),e.textContent=t,console.debug("BLOCK_MV3: Updated blocked url text to: ",t)}(),async function(){const e=document.getElementById("app-db-version"),o=t.runtime.getManifest().version;console.debug("BLOCK_MV3: App VErsion",{bgVersion:o});const n=await(s="lastDBused",new Promise(((e,o)=>{t.storage.local.get(s,(n=>t.runtime.lastError?o(t.runtime.lastError):e(n[s])))})));var s;console.debug("BLOCK_MV3: App DB VErsion",{dbVersion:n});const r=`Heuristics: ${d()}`;e.textContent=`v${o} | ${null==n?r:n}`}()}))}))})();